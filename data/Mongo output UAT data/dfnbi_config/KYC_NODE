{ "_id" : ObjectId("5a6607508b5756edbd5f544c"), "root" : true, "system" : "OMS", "nodeId" : 1, "name" : "Customer", "oneToMany" : false, "path" : "Customer", "parentPath" : "", "parentReference" : "unq_id", "uidPath" : "uid", "sql" : "SELECT * FROM (SELECT  m243_identification_type || '_' || m243_id_no AS unq_id,  m01_c1_customer_id AS mubasher_no,  m243_id_no AS nin,  m242_description AS id_type,  m243_issue_date AS id_issue_date,  m243_expiry_date AS id_expiry_date,  m01_c1_passport_number AS passport,  m130_description AS title,  TRIM(NVL(m01_c1_arabic_first_name, '') || ' ' || TRIM(NVL (m01_c1_arabic_second_name, '') || ' ' || TRIM(NVL (m01_c1_arabic_third_name, '') || ' ' || TRIM(NVL (m01_c1_arabic_name, ''))))) AS arabic_name,  TRIM(NVL(m01_c1_other_names, '') || ' ' || TRIM(NVL (m01_c1_second_name, '') || ' ' || TRIM(NVL (m01_c1_third_name, '') || ' ' || TRIM(NVL (m01_c1_last_name, ''))))) AS first_name,  '' AS last_name,  m01_c1_pobox AS po_box,  m01_c1_street_address_1 || ' ' || m01_c1_street_address_2 AS address,  m01_c1_city AS city,  m01_c1_zip AS zip_code,  m01_c1_gender AS gender,  FLOOR (MONTHS_BETWEEN (SYSDATE, m01_c1_dob) / 12) AS age,  m01_c1_dob AS date_of_birth,  m01_c1_home_tel AS home_tel,  m01_c1_mobile AS mobile,  m01_c1_fax AS fax,  m01_c1_email AS email,  m01_nationality AS nationality,  m30_country_name AS country,  m06_other_names || ' ' || m06_last_name AS created_by,  m01_created_date AS created_date,  m01_modified_date AS modified_date,  m01_external_ref_no AS external_ref,  CASE  WHEN m01_trading_enabled = 0 THEN 'No'  WHEN m01_trading_enabled = 1 THEN 'Yes'  END  AS trading_enabled,  m53_location AS location,  m64_customer_status.m64_approval_status AS status,  m01_status_changed_date AS status_changed_date,  m73_description AS customer_group,  m01_customer_group AS customer_group_id,  m01_signup_date AS sign_up_date,  m01_power_of_atterny AS power_of_attorney,  CASE  WHEN m01_is_online_registered = 0 THEN 'No'  WHEN m01_is_online_registered = 1 THEN 'Yes'  END  AS online_registered,  CASE  WHEN m01_account_category = 0 THEN 'Individual'  WHEN m01_account_category = 1 THEN 'Join Account'  WHEN m01_account_category = 2 THEN 'Cooperate'  END  AS customer_type,  m01_prefered_language AS preferred_language,  m254_name AS relationship_manager,  m64_dormant_status.m64_approval_status AS inactive_dormant_status FROM m01_customer,  m30_country,  m06_employees,  m64_approval_status m64_customer_status,  m64_approval_status m64_dormant_status,  m53_locations,  m242_identity_types,  m254_relationship_managers,  m130_titles,  m243_customer_identifications,  m73_customer_groups  WHERE m01_country_id = m30_country_id(+)  AND m01_created_by = m06_id  AND m01_status_id = m64_customer_status.m64_id  AND m01_inactive_dormant_status = m64_dormant_status.m64_id(+)  AND m01_locations_id = m53_location_id(+)  AND m243_identification_type = m242_id  AND m01_customer_id = m243_customer(+)  AND m01_relationship_manager = m254_id(+)  AND m01_title = m130_id(+)  AND m01_customer_group = m73_id(+)) WHERE unq_id BETWEEN ? AND ?", "countQuery" : "SELECT m243_identification_type || '_' || m243_id_no AS unq_id FROM m01_customer, m243_customer_identifications WHERE m01_customer_id = m243_customer", "dataSource" : "OMSDB" }{ "_id" : ObjectId("5a6607508b5756edbd5f544d"), "root" : false, "nodeId" : 2, "name" : "Investor", "oneToMany" : true, "path" : "Customer.Investor", "parentPath" : "Customer", "parentReference" : "unq_id", "uidPath" : "uid", "sql" : " SELECT         m243_identification_type || '_' || m243_id_no AS unq_id,     t03_accountno AS account_no,    t03_currency AS currency,    b.m06_other_names || ' ' || b.m06_last_name AS created_by,    t03_created_date AS created_date,    c.m06_other_names || ' ' || c.m06_last_name AS modified_by,    t03_modified_date AS modified_date,    CASE       WHEN t03_margin_enabled = 0 THEN 'No'       WHEN t03_margin_enabled = 1 THEN 'Yes'    END       AS margin_enabled,    e.m64_approval_status AS status,    t03_status_changed_date AS status_changed_date,    t03_last_activity_date AS last_activity_date,    t03_iban_no AS iban_no,    t03_investor_acc_no AS investor_account,    t03_inactive_dormant_date AS inactive_dormant_date,    f.m64_approval_status AS inactive_dormant_status  FROM t03_cash_account a,     m06_employees b,     m06_employees c,     m243_customer_identifications d,    m64_approval_status e,     m64_approval_status f   WHERE a.t03_created_by = b.m06_id    AND t03_status_id = e.m64_id    AND t03_inactive_dormant_status = f.m64_id(+)    AND a.t03_modified_by = c.m06_id (+)    AND t03_profile_id = m243_customer(+)     AND  m243_identification_type || '_' || m243_id_no BETWEEN ? AND ? ORDER BY t03_created_date ASC", "countQuery" : "SELECT COUNT(t03_profile_id) FROM t03_cash_account", "dataSource" : "OMSDB" }{ "_id" : ObjectId("5a6607508b5756edbd5f544e"), "root" : false, "nodeId" : 3, "name" : "Portfolio", "oneToMany" : true, "path" : "Customer.Portfolio", "parentPath" : "Customer", "parentReference" : "unq_id", "uidPath" : "uid", "sql" : "  SELECT    m243_identification_type || '_' || m243_id_no AS unq_id,     u05_accountno AS portfolio,    u05_cashaccountno AS cash_account,    u06_exchange AS exchange,    u06_exchange_ac AS account_no,    u06_trading_enabled AS trading_enabled,    u06_created_by AS created_by,    u06_created_date AS created_date,    u06_modified_by AS modified_by,    u06_modified_date AS modified_date,    m64_approval_status AS status  FROM u06_routing_accounts a,    u05_security_accounts b,    m64_approval_status c,    m243_customer_identifications d  WHERE  b.u05_id = a.u06_security_ac_id (+)     AND u06_status_id = m64_id       AND u05_customer_id = m243_customer(+)     AND  m243_identification_type || '_' || m243_id_no BETWEEN ? AND ? ORDER BY u06_created_date ASC", "countQuery" : "SELECT COUNT(u05_customer_id) FROM u06_routing_accounts a, u05_security_accounts b WHERE  b.u05_id = a.u06_security_ac_id (+)", "dataSource" : "OMSDB" }{ "_id" : ObjectId("5a6607508b5756edbd5f544f"), "root" : false, "nodeId" : 4, "name" : "Bank", "oneToMany" : true, "path" : "Customer.Bank", "parentPath" : "Customer", "parentReference" : "unq_id", "uidPath" : "uid", "sql" : " SELECT      m243_identification_type || '_' || m243_id_no AS unq_id,     m128_ac_no AS bank_account,    m128_currency AS currency,    m128_acc_name AS account_name,    m128_bank_branch_name AS branch_name,    m36_swift_code AS swift_code,    m128_created_date AS created_date,    m128_modified_date AS modified_date,    m128_iban_no AS iban_no,    m36_bank_name_1 AS bank_name  FROM m128_customer_bank_accounts a,     m36_banks b,    m243_customer_identifications c  WHERE a.m128_bank_id = b.m36_bank_id     AND m128_customer_id = m243_customer(+)    AND  m243_identification_type || '_' || m243_id_no BETWEEN ? AND ? ORDER BY m128_created_date ASC", "countQuery" : "SELECT COUNT(m128_customer_id) FROM m128_customer_bank_accounts", "dataSource" : "OMSDB" }{ "_id" : ObjectId("5a6607508b5756edbd5f5450"), "root" : false, "nodeId" : 5, "name" : "trading_summary", "oneToMany" : true, "path" : "Customer.trading_summary", "parentPath" : "Customer", "parentReference" : "unq_id", "uidPath" : "uid", "sql" : "SELECT /*+ USE_MERGE(M243_CUSTOMER_IDENTIFICATIONS,M01_CUSTOMER,M41_CHARGES) */ MAX(m243_identification_type || '_' || m243_id_no) AS unq_id,        t05_code AS code,        MAX(m41_description_1) AS description,        ROUND(AVG(ABS(t05_amount))* MAX(m03_rate), 2) AS avg_amount,        ROUND(SUM(ABS(t05_amount))* MAX(m03_rate), 2) AS sum_amount,        ROUND(SUM(ABS(t05_amount))* MAX(m03_rate)/180, 2) AS avg_amount_day,        COUNT(t05_code) AS no_of_txns,        ROUND(COUNT(t05_code)/6) AS avg_no_of_txns,       'SAR' AS currency   FROM t05_cash_account_log,        m41_charges,        m01_customer,        m243_customer_identifications,        m03_exchange_rates  WHERE m41_code = t05_code    AND m01_customer_id = m243_customer    AND m01_c1_customer_id = t05_mubasher_no    AND t05_date > sysdate - 180    AND t05_code IN ('STLBUY','STLSEL','WITHDR','DEPOST')    AND m03_c1 = t05_transaction_currency    AND m03_c2 = 'SAR'    AND m243_identification_type || '_' || m243_id_no BETWEEN ? AND ?  GROUP BY t05_code,  m243_identification_type || '_' || m243_id_no  ORDER BY unq_id ASC, t05_code ASC", "countQuery" : "SELECT count(*) FROM t05_cash_account_log,  m41_charges, m01_customer,  m243_customer_identifications  WHERE m41_code = t05_code  AND m01_customer_id = m243_customer   AND m01_c1_customer_id = t05_mubasher_no  AND t05_code IN ('STLBUY','STLSEL','WITHDR','DEPOST')  AND t05_date > sysdate - 180 GROUP BY t05_code, m243_identification_type || '_' || m243_id_no", "dataSource" : "OMSDB" }{ "_id" : ObjectId("5a6607508b5756edbd5f5451"), "root" : false, "nodeId" : 6, "name" : "trading_summary_previous_6_months", "oneToMany" : true, "path" : "Customer.trading_summary_previous_6_months", "parentPath" : "Customer", "parentReference" : "unq_id", "uidPath" : "uid", "sql" : "SELECT /*+ USE_MERGE(M243_CUSTOMER_IDENTIFICATIONS,M01_CUSTOMER,M41_CHARGES) */ MAX(m243_identification_type || '_' || m243_id_no) AS unq_id,  t05_code AS code,  MAX(m41_description_1) AS description,  ROUND(AVG(ABS(t05_amount))* MAX(m03_rate), 2) AS avg_amount,  ROUND(SUM(ABS(t05_amount))* MAX(m03_rate), 2) AS sum_amount,  ROUND(SUM(ABS(t05_amount))* MAX(m03_rate)/180, 2) AS avg_amount_day,  COUNT(t05_code) AS no_of_txns,  ROUND(COUNT(t05_code)/6) AS avg_no_of_txns,  'SAR' AS currency  FROM t05_cash_account_log,    m41_charges,     m01_customer,     m243_customer_identifications,     m03_exchange_rates  WHERE m41_code = t05_code     AND m01_customer_id = m243_customer     AND m01_c1_customer_id = t05_mubasher_no     AND (      (t05_date > TO_DATE((TO_CHAR(sysdate, 'yyyy') - 1) || '-04-01','yyyy-mm-dd') AND t05_date < TO_DATE((TO_CHAR(sysdate, 'yyyy') - 1) || '-09-30','yyyy-mm-dd') AND TO_CHAR(sysdate, 'MM') < 4)      OR      (t05_date > TO_DATE((TO_CHAR(sysdate, 'yyyy') - 1) || '-10-01','yyyy-mm-dd') AND t05_date < TO_DATE((TO_CHAR(sysdate, 'yyyy')) || '-03-31','yyyy-mm-dd') AND TO_CHAR(sysdate, 'MM') >= 4 AND TO_CHAR(sysdate, 'MM') <= 9 )      OR      (t05_date > TO_DATE((TO_CHAR(sysdate, 'yyyy')) || '-04-01','yyyy-mm-dd')  AND t05_date < TO_DATE((TO_CHAR(sysdate, 'yyyy')) || '-09-30','yyyy-mm-dd') AND TO_CHAR(sysdate, 'MM') > 9 )      )     AND t05_code IN ('STLBUY','STLSEL','WITHDR','DEPOST')     AND m03_c1 = t05_transaction_currency     AND m03_c2 = 'SAR'    AND m243_identification_type || '_' || m243_id_no BETWEEN ? AND ?  GROUP BY t05_code, m243_identification_type || '_' || m243_id_no  ORDER BY unq_id ASC, t05_code ASC", "countQuery" : "SELECT count(*) FROM t05_cash_account_log,  m41_charges, m01_customer,  m243_customer_identifications  WHERE m41_code = t05_code      AND m01_customer_id = m243_customer     AND m01_c1_customer_id = t05_mubasher_no     AND t05_code IN ('STLBUY','STLSEL','WITHDR','DEPOST')     AND     (         (             t05_date > TO_DATE((TO_CHAR(sysdate, 'yyyy') - 1) || '-04-01','yyyy-mm-dd') AND t05_date < TO_DATE((TO_CHAR(sysdate, 'yyyy') - 1) || '-09-30','yyyy-mm-dd') AND TO_CHAR(sysdate, 'MM') < 4         )         OR         (             t05_date > TO_DATE((TO_CHAR(sysdate, 'yyyy') - 1) || '-10-01','yyyy-mm-dd') AND t05_date < TO_DATE((TO_CHAR(sysdate, 'yyyy')) || '-03-31','yyyy-mm-dd') AND TO_CHAR(sysdate, 'MM') >= 4 AND TO_CHAR(sysdate, 'MM') <= 9         )         OR         (             t05_date > TO_DATE((TO_CHAR(sysdate, 'yyyy')) || '-04-01','yyyy-mm-dd')  AND t05_date < TO_DATE((TO_CHAR(sysdate, 'yyyy')) || '-09-30','yyyy-mm-dd') AND TO_CHAR(sysdate, 'MM') > 9         )     )", "dataSource" : "OMSDB" }